name: "Main"

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: "ubuntu-latest"
    strategy:
      matrix:
        python-version: ["3.7", "3.8", "3.9", "3.10", "3.11"]

    steps:
      - uses: "actions/checkout@v4"

      - name: "Set up Python ${{ matrix.python-version }}"
        uses: "actions/setup-python@v4"
        with:
          python-version: "${{ matrix.python-version }}"

      - name: "Install dependencies"
        run: "python -m pip install -r requirements.txt"

      - name: "Build and export 3D models"
        run: "python main.py"

      - name: "Archive builds"
        uses: "actions/upload-artifact@v3"
        with:
          name: builds
          path: build/*

      - name: "Prepare a basic static site that displays the final model"
        run: |
          mkdir -p public
          cp build/assembly.gltf public/
          cat >public/index.html <<EOF
          <!DOCTYPE html>
          <html>
            <head>
              <title>3D Model</title>
            </head>
            <body>
              <model-viewer src="assembly.gltf" ar ar-modes="webxr scene-viewer quick-look" camera-controls poster="poster.webp" shadow-intensity="1" environment-image="spruit_sunrise_1k_HDR.hdr" skybox-image="spruit_sunrise_1k_HDR.hdr" auto-rotate> </model-viewer>
            </body>
          </html>
          EOF
      - name: Deploy static site
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: public




